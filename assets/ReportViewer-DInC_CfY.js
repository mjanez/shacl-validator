import{r as n,j as e,m as J,z as Q,A as F,P as Z,C as _,D as ee,T as U,E as se,X as re,Y as te,F as g}from"./vendor-DeOzNnCe.js";import{w as ae,V as ie}from"./ValidationResults-Dv2nipMh.js";import{c as K,B as p,S as z}from"./index-CjHq_cR5.js";import{C as w,a as b,b as N,c as E,d as y}from"./card-I_EXJbgY.js";import{T as ne,a as le,b as P,c as $}from"./tabs-UtVytt-G.js";import{A as oe,a as ce,b as de,c as me}from"./accordion-CmZK7xl1.js";import{B as xe}from"./badge-Dzn6jquN.js";import{U as C,j as ue,X as pe,h as he}from"./icons-DzqCe8up.js";import"./markdown-4lR-MDu2.js";import"./shacl-Df9T_beC.js";import"./rdf-Brpq9PiH.js";import"./ui-BZxp6V2X.js";const H=n.forwardRef(({className:r,...t},h)=>e.jsx("textarea",{className:K("flex min-h-[120px] w-full rounded-md border border-input bg-background px-4 py-3 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:h,...t}));H.displayName="Textarea";const Re=()=>{const{t:r}=J(),[t,h]=n.useState(null),[k,S]=n.useState(!1),[T,f]=n.useState(null),[m,j]=n.useState(""),[R,A]=n.useState(null),[M,L]=n.useState("upload"),v=n.useRef(null);n.useEffect(()=>{const s=new Worker(new URL("/assets/reportWorker-DAn0hnvB.js",import.meta.url),{type:"module"});return v.current=ae(s),()=>s.terminate()},[]);const W=async()=>{if(!(!m.trim()||!v.current)){S(!0),f(null);try{const s=await v.current.parseShaclReport(m);h(s)}catch(s){console.error(s),f(`${r("viewer.error")} ${s.message}`)}finally{S(!1)}}},V=n.useCallback((s,a)=>{j(s),A(a),L("upload")},[]),O=n.useCallback(s=>{const a=s[0];if(!a)return;const i=new FileReader;i.onload=l=>{l.target?.result&&V(l.target.result,a.name)},i.readAsText(a)},[V]),{getRootProps:X,getInputProps:Y,isDragActive:I}=Q({onDrop:O,accept:{"text/turtle":[".ttl"],"application/rdf+xml":[".rdf",".xml"],"application/ld+json":[".jsonld"]},multiple:!1}),q=n.useCallback(()=>{j(""),A(null),f(null)},[]),o={violation:"hsl(0 72% 50%)",warning:"hsl(45 93% 47%)",info:"hsl(210 80% 60%)"},x=n.useMemo(()=>t?[{name:r("severity.violation"),value:t.violations.length,color:o.violation},{name:r("severity.warning"),value:t.warnings.length,color:o.warning},{name:r("severity.info"),value:t.infos.length,color:o.info}]:[],[t,r]),B=n.useMemo(()=>{if(!t)return[];const s=new Map,a=(i,l)=>{i.forEach(u=>{const d=u.sourceShape||u.focusNode||"n/a",c=s.get(d)||{violation:0,warning:0,info:0};c[l]+=1,s.set(d,c)})};return a(t.violations,"violation"),a(t.warnings,"warning"),a(t.infos,"info"),Array.from(s.entries()).map(([i,l])=>({name:i,...l,total:l.violation+l.warning+l.info})).sort((i,l)=>l.total-i.total).slice(0,6)},[t]),G=({active:s,payload:a})=>{if(!s||!a?.length)return null;const i=a[0].payload;return e.jsxs("div",{className:"rounded-xl border border-border bg-card/90 px-3 py-2 text-xs",children:[e.jsx("p",{className:"font-semibold",children:i.name}),e.jsxs("p",{className:"text-destructive",children:[r("severity.violation"),": ",i.violation]}),e.jsxs("p",{className:"text-amber-600",children:[r("severity.warning"),": ",i.warning]}),e.jsxs("p",{className:"text-sky-600",children:[r("severity.info"),": ",i.info]})]})},D=async(s,a)=>{if(!t)return;const i={...t,violations:s==="Violation"?t.violations:[],warnings:s==="Warning"?t.warnings:[],infos:s==="Info"?t.infos:[],totalViolations:s==="Violation"?t.violations.length:0},l=a==="ttl"?await z.exportReportAsTurtle(i):await z.exportReportAsCSV(i),u=new Blob([l],{type:a==="ttl"?"text/turtle":"text/csv"}),d=URL.createObjectURL(u),c=document.createElement("a");c.href=d,c.download=`shacl-${s.toLowerCase()}-${new Date().toISOString()}.${a}`,c.click(),URL.revokeObjectURL(d)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6",children:[e.jsx("h2",{className:"font-display text-2xl font-semibold",children:r("viewer.title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:r("viewer.subtitle")})]}),e.jsxs(w,{children:[e.jsxs(b,{children:[e.jsx(N,{children:r("viewer.import")}),e.jsx(E,{children:r("viewer.importDescription")})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs(ne,{value:M,onValueChange:s=>L(s),children:[e.jsxs(le,{className:"w-full",children:[e.jsxs(P,{value:"upload",className:"flex-1",children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),r("viewer.upload")]}),e.jsxs(P,{value:"paste",className:"flex-1",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),r("viewer.paste")]})]}),e.jsx($,{value:"upload",className:"border-0 p-0 pt-4",children:R?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-border/70 bg-muted/30 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(C,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:R}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r("viewer.fileLoaded")})]})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:q,className:"h-8 w-8 text-muted-foreground hover:text-destructive","aria-label":r("common.clear"),children:e.jsx(pe,{className:"h-4 w-4"})})]})}):e.jsxs("div",{...X(),className:K("cursor-pointer rounded-2xl border-2 border-dashed transition-colors",I?"border-primary bg-primary/5":"border-border/70 hover:border-primary/50 hover:bg-muted/30"),children:[e.jsx("input",{...Y()}),e.jsxs("div",{className:"flex flex-col items-center gap-4 px-6 py-12 text-center",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-2xl bg-primary/10",children:e.jsx(C,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-medium text-foreground",children:r(I?"viewer.dropActive":"viewer.dropInactive")}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:r("viewer.uploadHint")})]})]})]})}),e.jsx($,{value:"paste",className:"border-0 p-0 pt-4",children:e.jsx(H,{rows:10,value:m,onChange:s=>j(s.target.value),className:"font-mono text-xs",placeholder:r("viewer.pasteHint")})})]}),T&&e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-destructive/40 bg-destructive/5 px-4 py-3 text-sm text-destructive",children:[e.jsx(he,{className:"h-4 w-4"}),T]}),e.jsx(p,{onClick:W,disabled:!m.trim()||k,className:"w-full sm:w-auto",children:r(k?"common.validating":"viewer.visualize")})]})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(N,{children:r("viewer.severityBreakdown")})}),e.jsx(y,{className:"h-80",children:x.length?e.jsxs(e.Fragment,{children:[e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(Z,{children:[e.jsx(_,{data:x,dataKey:"value",nameKey:"name",innerRadius:70,outerRadius:110,paddingAngle:4,children:x.map(s=>e.jsx(ee,{fill:s.color},`cell-${s.name}`))}),e.jsx(U,{})]})}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:x.map(s=>e.jsxs(xe,{style:{backgroundColor:s.color},className:"text-white",children:[s.name,": ",s.value]},s.name))})]}):e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground",children:r("viewer.emptyStats")})})]}),e.jsxs(w,{children:[e.jsxs(b,{children:[e.jsx(N,{children:r("viewer.topShapes")}),e.jsx(E,{children:r("viewer.topShapesHint")})]}),e.jsx(y,{className:"h-80",children:B.length?e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(se,{data:B,layout:"vertical",margin:{left:0,right:16},children:[e.jsx(re,{type:"number",hide:!0}),e.jsx(te,{dataKey:"name",type:"category",width:180,tick:{fontSize:11}}),e.jsx(U,{content:G,cursor:{fill:"hsl(var(--muted)/0.3)"}}),e.jsx(g,{dataKey:"violation",stackId:"issues",fill:o.violation,radius:[0,6,6,0]}),e.jsx(g,{dataKey:"warning",stackId:"issues",fill:o.warning,radius:[0,6,6,0]}),e.jsx(g,{dataKey:"info",stackId:"issues",fill:o.info,radius:[0,6,6,0]})]})}):e.jsx("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-center text-sm text-muted-foreground",children:e.jsx("p",{children:r("viewer.emptyShapes")})})})]})]}),e.jsx(oe,{type:"multiple",defaultValue:["segments"],children:e.jsxs(ce,{value:"segments",children:[e.jsx(de,{children:r("viewer.exportSegments")}),e.jsx(me,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:["Violation","Warning","Info"].map(s=>e.jsxs("div",{className:"rounded-2xl border border-border p-4",children:[e.jsx("p",{className:"text-sm font-semibold",children:r(`severity.${s.toLowerCase()}`)}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>D(s,"ttl"),children:"TTL"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>D(s,"csv"),children:"CSV"})]})]},s))})})]})}),e.jsx(ie,{report:t})]})]})};export{Re as default};

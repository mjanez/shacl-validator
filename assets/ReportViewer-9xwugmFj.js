import{j as e}from"./markdown-D3Wn7UNJ.js";import{r as l,j as g,P as je,k as ge,C as ve,T as v,B as S,X as R,Y as T,l as x}from"./charts-BadQMOzK.js";import{u as we,T as Ne}from"./textarea-aiGtNTGE.js";import{w as be,V as ye}from"./ValidationResults-Bt1Nyn-6.js";import{u as Ce,B as w,c as V,S as Z}from"./index-C_N_pDr6.js";import{C as h,a as p,b as f,c as N,d as j}from"./card-D9Z4SY08.js";import{T as _,a as ee,b as B,c as A}from"./tabs-BWv615uy.js";import{A as ke,a as Se,b as Re,c as Te}from"./accordion-BlHkvs1a.js";import{B as Be}from"./badge-Dz63Ssq7.js";import{U as z,p as Ae,X as Ie,j as Le,e as se,q as Ke,R as Ve,d as ze,r as Me,s as Fe,L as qe,t as Pe}from"./icons-oLbWWKZ2.js";import"./ui-kIuPQhpd.js";import"./rdf-DktVfMyT.js";const Ze=()=>{const{t}=Ce(),[i,M]=l.useState(null),[F,q]=l.useState(!1),[P,b]=l.useState(null),[y,C]=l.useState(""),[D,I]=l.useState(null),[te,E]=l.useState("upload"),[re,H]=l.useState("import"),[ae,U]=l.useState("results"),L=l.useRef(null);l.useEffect(()=>{const s=new Worker(new URL("/assets/reportWorker-DAn0hnvB.js",import.meta.url),{type:"module"});return L.current=be(s),()=>s.terminate()},[]);const ie=async()=>{if(!(!y.trim()||!L.current)){q(!0),b(null);try{const s=await L.current.parseShaclReport(y);M(s),H("results")}catch(s){console.error(s),b(`${t("viewer.error")} ${s.message}`)}finally{q(!1)}}},ne=()=>{M(null),C(""),I(null),b(null),H("import"),U("results")},$=l.useCallback((s,n)=>{C(s),I(n),E("upload")},[]),le=l.useCallback(s=>{const n=s[0];if(!n)return;const r=new FileReader;r.onload=a=>{a.target?.result&&$(a.target.result,n.name)},r.readAsText(n)},[$]),{getRootProps:oe,getInputProps:ce,isDragActive:O}=we({onDrop:le,accept:{"text/turtle":[".ttl"],"application/rdf+xml":[".rdf",".xml"],"application/ld+json":[".jsonld"]},multiple:!1}),de=l.useCallback(()=>{C(""),I(null),b(null)},[]),c={violation:"hsl(0 72% 50%)",warning:"hsl(45 93% 47%)",info:"hsl(210 80% 60%)"},k=l.useMemo(()=>i?[{name:t("severity.violation"),value:i.violations.length,color:c.violation},{name:t("severity.warning"),value:i.warnings.length,color:c.warning},{name:t("severity.info"),value:i.infos.length,color:c.info}]:[],[i,t]),W=l.useMemo(()=>{if(!i)return[];const s=new Map,n=(r,a)=>{r.forEach(o=>{const d=o.sourceShape||o.focusNode||"n/a",m=s.get(d)||{violation:0,warning:0,info:0};m[a]+=1,s.set(d,m)})};return n(i.violations,"violation"),n(i.warnings,"warning"),n(i.infos,"info"),Array.from(s.entries()).map(([r,a])=>({name:r.split(/[#/]/).pop()||r,fullName:r,...a,total:a.violation+a.warning+a.info})).sort((r,a)=>a.total-r.total).slice(0,6)},[i]),X=l.useMemo(()=>{if(!i)return[];const s=new Map,n=(r,a)=>{r.forEach(o=>{if(!o.path)return;const d=o.path,m=s.get(d)||{violation:0,warning:0,info:0};m[a]+=1,s.set(d,m)})};return n(i.violations,"violation"),n(i.warnings,"warning"),n(i.infos,"info"),Array.from(s.entries()).map(([r,a])=>({name:r.split(/[#/]/).pop()||r,fullName:r,...a,total:a.violation+a.warning+a.info})).sort((r,a)=>a.total-r.total).slice(0,8)},[i]),Y=l.useMemo(()=>{if(!i)return[];const s=new Map,n=(r,a)=>{r.forEach(o=>{if(!o.focusNode)return;const d=o.focusNode.match(/\/(dataset|distribution|catalog|dataservice|agent|organization|contactpoint|periodOfTime)/i),m=d?d[1].charAt(0).toUpperCase()+d[1].slice(1).toLowerCase():"Other",Q=s.get(m)||{violation:0,warning:0,info:0};Q[a]+=1,s.set(m,Q)})};return n(i.violations,"violation"),n(i.warnings,"warning"),n(i.infos,"info"),Array.from(s.entries()).map(([r,a])=>({name:r,...a,total:a.violation+a.warning+a.info})).sort((r,a)=>a.total-r.total)},[i]),G=l.useMemo(()=>{if(!i)return[];const s=new Map;return[...i.violations,...i.warnings,...i.infos].forEach(r=>{if(!r.sourceConstraintComponent)return;const a=r.sourceConstraintComponent.split(/[#/]/).pop()||r.sourceConstraintComponent;s.set(a,(s.get(a)||0)+1)}),Array.from(s.entries()).map(([r,a])=>({name:r,value:a})).sort((r,a)=>a.value-r.value).slice(0,8)},[i]),u=l.useMemo(()=>{if(!i)return null;const s=[...i.violations,...i.warnings,...i.infos],n=new Set(s.map(o=>o.focusNode).filter(Boolean)).size,r=new Set(s.map(o=>o.sourceShape).filter(Boolean)).size,a=new Set(s.map(o=>o.path).filter(Boolean)).size;return{totalResults:s.length,conforms:i.conforms,uniqueFocusNodes:n,uniqueShapes:r,uniqueProperties:a}},[i]),K=({active:s,payload:n})=>{if(!s||!n?.length)return null;const r=n[0].payload;return e.jsxs("div",{className:"rounded-xl border border-border bg-card/90 px-3 py-2 text-xs shadow-lg",children:[e.jsx("p",{className:"font-semibold truncate max-w-xs",title:r.fullName,children:r.name}),e.jsxs("p",{className:"text-destructive",children:[t("severity.violation"),": ",r.violation]}),e.jsxs("p",{className:"text-amber-600",children:[t("severity.warning"),": ",r.warning]}),e.jsxs("p",{className:"text-sky-600",children:[t("severity.info"),": ",r.info]})]})},me=({active:s,payload:n})=>{if(!s||!n?.length)return null;const r=n[0].payload;return e.jsxs("div",{className:"rounded-xl border border-border bg-card/90 px-3 py-2 text-xs shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:r.name}),e.jsxs("p",{children:[t("table.count"),": ",r.value]})]})},J=async(s,n)=>{if(!i)return;const r={...i,violations:s==="Violation"?i.violations:[],warnings:s==="Warning"?i.warnings:[],infos:s==="Info"?i.infos:[],totalViolations:s==="Violation"?i.violations.length:0},a=n==="ttl"?await Z.exportReportAsTurtle(r):await Z.exportReportAsCSV(r),o=new Blob([a],{type:n==="ttl"?"text/turtle":"text/csv"}),d=URL.createObjectURL(o),m=document.createElement("a");m.href=d,m.download=`shacl-${s.toLowerCase()}-${new Date().toISOString()}.${n}`,m.click(),URL.revokeObjectURL(d)},xe=()=>e.jsxs(h,{children:[e.jsxs(p,{children:[e.jsx(f,{children:t("viewer.import")}),e.jsx(N,{children:t("viewer.importDescription")})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs(_,{value:te,onValueChange:s=>E(s),children:[e.jsxs(ee,{className:"w-full",children:[e.jsxs(B,{value:"upload",className:"flex-1",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),t("viewer.upload")]}),e.jsxs(B,{value:"paste",className:"flex-1",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),t("viewer.paste")]})]}),e.jsx(A,{value:"upload",className:"border-0 p-0 pt-4",children:D?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-border/70 bg-muted/30 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(z,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:D}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t("viewer.fileLoaded")})]})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:de,className:"h-8 w-8 text-muted-foreground hover:text-destructive","aria-label":t("common.clear"),children:e.jsx(Ie,{className:"h-4 w-4"})})]})}):e.jsxs("div",{...oe(),className:V("cursor-pointer rounded-2xl border-2 border-dashed transition-colors",O?"border-primary bg-primary/5":"border-border/70 hover:border-primary/50 hover:bg-muted/30"),children:[e.jsx("input",{...ce()}),e.jsxs("div",{className:"flex flex-col items-center gap-4 px-6 py-12 text-center",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-2xl bg-primary/10",children:e.jsx(z,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-medium text-foreground",children:t(O?"viewer.dropActive":"viewer.dropInactive")}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:t("viewer.uploadHint")})]})]})]})}),e.jsx(A,{value:"paste",className:"border-0 p-0 pt-4",children:e.jsx(Ne,{rows:10,value:y,onChange:s=>C(s.target.value),className:"font-mono text-xs",placeholder:t("viewer.pasteHint")})})]}),P&&e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-destructive/40 bg-destructive/5 px-4 py-3 text-sm text-destructive",children:[e.jsx(Le,{className:"h-4 w-4"}),P]}),e.jsx(w,{onClick:ie,disabled:!y.trim()||F,className:"w-full sm:w-auto",children:t(F?"common.validating":"viewer.visualize")})]})]}),ue=()=>u?e.jsxs(h,{className:"bg-gradient-to-br from-card to-muted/30",children:[e.jsx(p,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{className:"text-lg",children:t("viewer.summary.title")}),e.jsxs(w,{variant:"outline",size:"sm",onClick:ne,className:"gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),t("viewer.reset")]})]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-border/50 bg-card/50 p-3",children:[e.jsx("div",{className:V("flex h-10 w-10 items-center justify-center rounded-lg",u.conforms?"bg-green-500/10":"bg-destructive/10"),children:u.conforms?e.jsx(ze,{className:"h-5 w-5 text-green-500"}):e.jsx(Me,{className:"h-5 w-5 text-destructive"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:t("viewer.summary.conformance")}),e.jsx("p",{className:V("text-sm font-semibold",u.conforms?"text-green-500":"text-destructive"),children:u.conforms?t("viewer.summary.conforms"):t("viewer.summary.notConforms")})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-border/50 bg-card/50 p-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(Fe,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:t("viewer.summary.totalResults")}),e.jsx("p",{className:"text-sm font-semibold",children:u.totalResults})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-border/50 bg-card/50 p-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-amber-500/10",children:e.jsx(se,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:t("viewer.summary.uniqueFocusNodes")}),e.jsx("p",{className:"text-sm font-semibold",children:u.uniqueFocusNodes})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-border/50 bg-card/50 p-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-sky-500/10",children:e.jsx(qe,{className:"h-5 w-5 text-sky-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:t("viewer.summary.uniqueShapes")}),e.jsx("p",{className:"text-sm font-semibold",children:u.uniqueShapes})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border border-border/50 bg-card/50 p-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-purple-500/10",children:e.jsx(Pe,{className:"h-5 w-5 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:t("viewer.summary.uniqueProperties")}),e.jsx("p",{className:"text-sm font-semibold",children:u.uniqueProperties})]})]})]})})]}):null,he=()=>e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsx(f,{className:"text-base",children:t("viewer.severityBreakdown")})}),e.jsx(j,{className:"h-64",children:k.length?e.jsxs(e.Fragment,{children:[e.jsx(g,{width:"100%",height:"80%",children:e.jsxs(je,{children:[e.jsx(ge,{data:k,dataKey:"value",nameKey:"name",innerRadius:50,outerRadius:80,paddingAngle:4,children:k.map(s=>e.jsx(ve,{fill:s.color},`cell-${s.name}`))}),e.jsx(v,{})]})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:k.map(s=>e.jsxs(Be,{style:{backgroundColor:s.color},className:"text-white text-xs",children:[s.name,": ",s.value]},s.name))})]}):e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground",children:t("viewer.emptyStats")})})]}),e.jsxs(h,{children:[e.jsxs(p,{className:"pb-2",children:[e.jsx(f,{className:"text-base",children:t("viewer.topShapes")}),e.jsx(N,{className:"text-xs",children:t("viewer.topShapesHint")})]}),e.jsx(j,{className:"h-64",children:W.length?e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(S,{data:W,layout:"vertical",margin:{left:0,right:16},children:[e.jsx(R,{type:"number",hide:!0}),e.jsx(T,{dataKey:"name",type:"category",width:120,tick:{fontSize:10}}),e.jsx(v,{content:K,cursor:{fill:"hsl(var(--muted)/0.3)"}}),e.jsx(x,{dataKey:"violation",stackId:"issues",fill:c.violation,radius:[0,4,4,0]}),e.jsx(x,{dataKey:"warning",stackId:"issues",fill:c.warning,radius:[0,4,4,0]}),e.jsx(x,{dataKey:"info",stackId:"issues",fill:c.info,radius:[0,4,4,0]})]})}):e.jsx("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-center text-sm text-muted-foreground",children:e.jsx("p",{children:t("viewer.emptyShapes")})})})]})]}),pe=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(h,{children:[e.jsxs(p,{className:"pb-2",children:[e.jsx(f,{className:"text-base",children:t("viewer.propertyBreakdown")}),e.jsx(N,{className:"text-xs",children:t("viewer.propertyBreakdownHint")})]}),e.jsx(j,{className:"h-72",children:X.length?e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(S,{data:X,layout:"vertical",margin:{left:0,right:16},children:[e.jsx(R,{type:"number",hide:!0}),e.jsx(T,{dataKey:"name",type:"category",width:140,tick:{fontSize:10}}),e.jsx(v,{content:K,cursor:{fill:"hsl(var(--muted)/0.3)"}}),e.jsx(x,{dataKey:"violation",stackId:"issues",fill:c.violation,radius:[0,4,4,0]}),e.jsx(x,{dataKey:"warning",stackId:"issues",fill:c.warning,radius:[0,4,4,0]}),e.jsx(x,{dataKey:"info",stackId:"issues",fill:c.info,radius:[0,4,4,0]})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground text-sm",children:t("viewer.emptyStats")})})]}),e.jsxs(h,{children:[e.jsxs(p,{className:"pb-2",children:[e.jsx(f,{className:"text-base",children:t("viewer.focusNodeBreakdown")}),e.jsx(N,{className:"text-xs",children:t("viewer.focusNodeBreakdownHint")})]}),e.jsx(j,{className:"h-72",children:Y.length?e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(S,{data:Y,layout:"vertical",margin:{left:0,right:16},children:[e.jsx(R,{type:"number",hide:!0}),e.jsx(T,{dataKey:"name",type:"category",width:100,tick:{fontSize:11}}),e.jsx(v,{content:K,cursor:{fill:"hsl(var(--muted)/0.3)"}}),e.jsx(x,{dataKey:"violation",stackId:"issues",fill:c.violation,radius:[0,4,4,0]}),e.jsx(x,{dataKey:"warning",stackId:"issues",fill:c.warning,radius:[0,4,4,0]}),e.jsx(x,{dataKey:"info",stackId:"issues",fill:c.info,radius:[0,4,4,0]})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground text-sm",children:t("viewer.emptyStats")})})]})]}),e.jsxs(h,{children:[e.jsxs(p,{className:"pb-2",children:[e.jsx(f,{className:"text-base",children:t("viewer.constraintBreakdown")}),e.jsx(N,{className:"text-xs",children:t("viewer.constraintBreakdownHint")})]}),e.jsx(j,{className:"h-64",children:G.length?e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(S,{data:G,margin:{left:0,right:16},children:[e.jsx(R,{dataKey:"name",tick:{fontSize:10},angle:-30,textAnchor:"end",height:60}),e.jsx(T,{hide:!0}),e.jsx(v,{content:me,cursor:{fill:"hsl(var(--muted)/0.3)"}}),e.jsx(x,{dataKey:"value",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})}):e.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground text-sm",children:t("viewer.emptyStats")})})]}),e.jsx(ke,{type:"multiple",defaultValue:["segments"],children:e.jsxs(Se,{value:"segments",children:[e.jsx(Re,{children:t("viewer.exportSegments")}),e.jsx(Te,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:["Violation","Warning","Info"].map(s=>e.jsxs("div",{className:"rounded-2xl border border-border p-4",children:[e.jsx("p",{className:"text-sm font-semibold",children:t(`severity.${s.toLowerCase()}`)}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:()=>J(s,"ttl"),children:"TTL"}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>J(s,"csv"),children:"CSV"})]})]},s))})})]})})]}),fe=()=>e.jsxs(e.Fragment,{children:[ue(),e.jsxs(_,{value:ae,onValueChange:s=>U(s),className:"mt-4",children:[e.jsxs(ee,{children:[e.jsxs(B,{value:"results",className:"gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),t("viewer.tabs.results")]}),e.jsxs(B,{value:"dashboard",className:"gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),t("viewer.tabs.dashboard")]})]}),e.jsxs(A,{value:"results",className:"mt-4 space-y-4",children:[he(),i&&e.jsx(ye,{report:i})]}),e.jsx(A,{value:"dashboard",className:"mt-4",children:pe()})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6",children:[e.jsx("h2",{className:"font-display text-2xl font-semibold",children:t("viewer.title")}),e.jsx("p",{className:"mt-2 text-muted-foreground",children:t("viewer.subtitle")})]}),re==="import"?xe():fe()]})};export{Ze as default};

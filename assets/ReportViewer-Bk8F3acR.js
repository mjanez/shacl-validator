import{r as e,j as s,i as r,x as a}from"./vendor-BQdnNnse.js";import{w as t,V as i}from"./ValidationResults-Cc5MvtoG.js";import{c as l,B as n,S as o}from"./index-47xqnsWu.js";import{C as d,a as c,b as m,c as x,d as u}from"./card-Bs7XvEkI.js";import{T as h,a as p,b as j,c as v}from"./tabs-iSiRALwc.js";import{A as f,a as g,b as w,c as b}from"./accordion-rMLDn1j0.js";import{B as y}from"./badge-TcTPySGN.js";import{U as N,j as k,X as S,h as C}from"./icons-DTq5M_W5.js";import{R,P as V,d as L,C as A,T as I,B as T,X as $,Y as B,e as K}from"./charts-DG9K48Xb.js";import"./markdown-CPnKlWtu.js";import"./shacl-__0s_w47.js";import"./rdf-D0oavnFg.js";import"./ui-wv8ySAhR.js";const U=e.forwardRef(({className:e,...r},a)=>s.jsx("textarea",{className:l("flex min-h-[120px] w-full rounded-md border border-input bg-background px-4 py-3 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));U.displayName="Textarea";const W=()=>{const{t:W}=r(),[z,D]=e.useState(null),[E,F]=e.useState(!1),[H,M]=e.useState(null),[O,P]=e.useState(""),[X,Y]=e.useState(null),[Z,q]=e.useState("upload"),G=e.useRef(null);e.useEffect(()=>{const e=new Worker(new URL("/assets/reportWorker-BWiw1jZW.js",import.meta.url),{type:"module"});return G.current=t(e),()=>e.terminate()},[]);const J=e.useCallback((e,s)=>{P(e),Y(s),q("upload")},[]),Q=e.useCallback(e=>{const s=e[0];if(!s)return;const r=new FileReader;r.onload=e=>{e.target?.result&&J(e.target.result,s.name)},r.readAsText(s)},[J]),{getRootProps:_,getInputProps:ee,isDragActive:se}=a({onDrop:Q,accept:{"text/turtle":[".ttl"],"application/rdf+xml":[".rdf",".xml"],"application/ld+json":[".jsonld"]},multiple:!1}),re=e.useCallback(()=>{P(""),Y(null),M(null)},[]),ae="hsl(0 72% 50%)",te="hsl(45 93% 47%)",ie="hsl(210 80% 60%)",le=e.useMemo(()=>z?[{name:W("severity.violation"),value:z.violations.length,color:ae},{name:W("severity.warning"),value:z.warnings.length,color:te},{name:W("severity.info"),value:z.infos.length,color:ie}]:[],[z,W]),ne=e.useMemo(()=>{if(!z)return[];const e=new Map,s=(s,r)=>{s.forEach(s=>{const a=s.sourceShape||s.focusNode||"n/a",t=e.get(a)||{violation:0,warning:0,info:0};t[r]+=1,e.set(a,t)})};return s(z.violations,"violation"),s(z.warnings,"warning"),s(z.infos,"info"),Array.from(e.entries()).map(([e,s])=>({name:e,...s,total:s.violation+s.warning+s.info})).sort((e,s)=>s.total-e.total).slice(0,6)},[z]),oe=async(e,s)=>{if(!z)return;const r={...z,violations:"Violation"===e?z.violations:[],warnings:"Warning"===e?z.warnings:[],infos:"Info"===e?z.infos:[],totalViolations:"Violation"===e?z.violations.length:0},a="ttl"===s?await o.exportReportAsTurtle(r):await o.exportReportAsCSV(r),t=new Blob([a],{type:"ttl"===s?"text/turtle":"text/csv"}),i=URL.createObjectURL(t),l=document.createElement("a");l.href=i,l.download=`shacl-${e.toLowerCase()}-${(new Date).toISOString()}.${s}`,l.click(),URL.revokeObjectURL(i)};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"rounded-3xl border border-border bg-card/70 p-6",children:[s.jsx("h2",{className:"font-display text-2xl font-semibold",children:W("viewer.title")}),s.jsx("p",{className:"mt-2 text-muted-foreground",children:W("viewer.subtitle")})]}),s.jsxs(d,{children:[s.jsxs(c,{children:[s.jsx(m,{children:W("viewer.import")}),s.jsx(x,{children:W("viewer.importDescription")})]}),s.jsxs(u,{className:"space-y-4",children:[s.jsxs(h,{value:Z,onValueChange:e=>q(e),children:[s.jsxs(p,{className:"w-full",children:[s.jsxs(j,{value:"upload",className:"flex-1",children:[s.jsx(N,{className:"mr-2 h-4 w-4"}),W("viewer.upload")]}),s.jsxs(j,{value:"paste",className:"flex-1",children:[s.jsx(k,{className:"mr-2 h-4 w-4"}),W("viewer.paste")]})]}),s.jsx(v,{value:"upload",className:"border-0 p-0 pt-4",children:X?s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-border/70 bg-muted/30 px-4 py-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10",children:s.jsx(N,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-sm font-medium",children:X}),s.jsx("span",{className:"text-xs text-muted-foreground",children:W("viewer.fileLoaded")})]})]}),s.jsx(n,{variant:"ghost",size:"icon",onClick:re,className:"h-8 w-8 text-muted-foreground hover:text-destructive","aria-label":W("common.clear"),children:s.jsx(S,{className:"h-4 w-4"})})]})}):s.jsxs("div",{..._(),className:l("cursor-pointer rounded-2xl border-2 border-dashed transition-colors",se?"border-primary bg-primary/5":"border-border/70 hover:border-primary/50 hover:bg-muted/30"),children:[s.jsx("input",{...ee()}),s.jsxs("div",{className:"flex flex-col items-center gap-4 px-6 py-12 text-center",children:[s.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-2xl bg-primary/10",children:s.jsx(N,{className:"h-8 w-8 text-primary"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-base font-medium text-foreground",children:W(se?"viewer.dropActive":"viewer.dropInactive")}),s.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:W("viewer.uploadHint")})]})]})]})}),s.jsx(v,{value:"paste",className:"border-0 p-0 pt-4",children:s.jsx(U,{rows:10,value:O,onChange:e=>P(e.target.value),className:"font-mono text-xs",placeholder:W("viewer.pasteHint")})})]}),H&&s.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-destructive/40 bg-destructive/5 px-4 py-3 text-sm text-destructive",children:[s.jsx(C,{className:"h-4 w-4"}),H]}),s.jsx(n,{onClick:async()=>{if(O.trim()&&G.current){F(!0),M(null);try{const e=await G.current.parseShaclReport(O);D(e)}catch(e){M(`${W("viewer.error")} ${e.message}`)}finally{F(!1)}}},disabled:!O.trim()||E,className:"w-full sm:w-auto",children:W(E?"common.validating":"viewer.visualize")})]})]}),z&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[s.jsxs(d,{children:[s.jsx(c,{children:s.jsx(m,{children:W("viewer.severityBreakdown")})}),s.jsx(u,{className:"h-80",children:le.length?s.jsxs(s.Fragment,{children:[s.jsx(R,{width:"100%",height:"100%",children:s.jsxs(V,{children:[s.jsx(L,{data:le,dataKey:"value",nameKey:"name",innerRadius:70,outerRadius:110,paddingAngle:4,children:le.map(e=>s.jsx(A,{fill:e.color},`cell-${e.name}`))}),s.jsx(I,{})]})}),s.jsx("div",{className:"mt-4 flex flex-wrap gap-3",children:le.map(e=>s.jsxs(y,{style:{backgroundColor:e.color},className:"text-white",children:[e.name,": ",e.value]},e.name))})]}):s.jsx("div",{className:"flex h-full items-center justify-center text-muted-foreground",children:W("viewer.emptyStats")})})]}),s.jsxs(d,{children:[s.jsxs(c,{children:[s.jsx(m,{children:W("viewer.topShapes")}),s.jsx(x,{children:W("viewer.topShapesHint")})]}),s.jsx(u,{className:"h-80",children:ne.length?s.jsx(R,{width:"100%",height:"100%",children:s.jsxs(T,{data:ne,layout:"vertical",margin:{left:0,right:16},children:[s.jsx($,{type:"number",hide:!0}),s.jsx(B,{dataKey:"name",type:"category",width:180,tick:{fontSize:11}}),s.jsx(I,{content:({active:e,payload:r})=>{if(!e||!r?.length)return null;const a=r[0].payload;return s.jsxs("div",{className:"rounded-xl border border-border bg-card/90 px-3 py-2 text-xs",children:[s.jsx("p",{className:"font-semibold",children:a.name}),s.jsxs("p",{className:"text-destructive",children:[W("severity.violation"),": ",a.violation]}),s.jsxs("p",{className:"text-amber-600",children:[W("severity.warning"),": ",a.warning]}),s.jsxs("p",{className:"text-sky-600",children:[W("severity.info"),": ",a.info]})]})},cursor:{fill:"hsl(var(--muted)/0.3)"}}),s.jsx(K,{dataKey:"violation",stackId:"issues",fill:ae,radius:[0,6,6,0]}),s.jsx(K,{dataKey:"warning",stackId:"issues",fill:te,radius:[0,6,6,0]}),s.jsx(K,{dataKey:"info",stackId:"issues",fill:ie,radius:[0,6,6,0]})]})}):s.jsx("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-center text-sm text-muted-foreground",children:s.jsx("p",{children:W("viewer.emptyShapes")})})})]})]}),s.jsx(f,{type:"multiple",defaultValue:["segments"],children:s.jsxs(g,{value:"segments",children:[s.jsx(w,{children:W("viewer.exportSegments")}),s.jsx(b,{children:s.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:["Violation","Warning","Info"].map(e=>s.jsxs("div",{className:"rounded-2xl border border-border p-4",children:[s.jsx("p",{className:"text-sm font-semibold",children:W(`severity.${e.toLowerCase()}`)}),s.jsxs("div",{className:"mt-3 flex gap-2",children:[s.jsx(n,{variant:"outline",size:"sm",onClick:()=>oe(e,"ttl"),children:"TTL"}),s.jsx(n,{variant:"ghost",size:"sm",onClick:()=>oe(e,"csv"),children:"CSV"})]})]},e))})})]})}),s.jsx(i,{report:z})]})]})};export{W as default};

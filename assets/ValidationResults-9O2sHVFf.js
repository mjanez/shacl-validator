import{i as e,r as t,j as r}from"./vendor-BQdnNnse.js";import{B as s,c as a,S as n}from"./index-cSWHyr3r.js";import{B as i}from"./badge-CZJJeZKD.js";import{C as o,a as l,b as c,c as d,d as p}from"./card-D9fYY6CR.js";import{d as u,k as m,l as f,m as x,n as h,o as g,E as w,p as v}from"./icons-DAOsTn3U.js";import{R as y,L as b,f as j}from"./charts-DG9K48Xb.js";import{M as N}from"./markdown-CPnKlWtu.js";
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const k=Symbol("Comlink.proxy"),S=Symbol("Comlink.endpoint"),E=Symbol("Comlink.releaseProxy"),C=Symbol("Comlink.finalizer"),L=Symbol("Comlink.thrown"),O=e=>"object"==typeof e&&null!==e||"function"==typeof e,R=new Map([["proxy",{canHandle:e=>O(e)&&e[k],serialize(e){const{port1:t,port2:r}=new MessageChannel;return M(e,t),[r,[r]]},deserialize:e=>(e.start(),P(e))}],["throw",{canHandle:e=>O(e)&&L in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function M(e,t=globalThis,r=["*"]){t.addEventListener("message",function s(a){if(!a||!a.data)return;if(!function(e,t){for(const r of e){if(t===r||"*"===r)return!0;if(r instanceof RegExp&&r.test(t))return!0}return!1}(r,a.origin))return;const{id:n,type:i,path:o}=Object.assign({path:[]},a.data),l=(a.data.argumentList||[]).map(H);let c;try{const t=o.slice(0,-1).reduce((e,t)=>e[t],e),r=o.reduce((e,t)=>e[t],e);switch(i){case"GET":c=r;break;case"SET":t[o.slice(-1)[0]]=H(a.data.value),c=!0;break;case"APPLY":c=r.apply(t,l);break;case"CONSTRUCT":c=function(e){return Object.assign(e,{[k]:!0})}(new r(...l));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;M(e,r),c=function(e,t){return W.set(e,t),e}(t,[t])}break;case"RELEASE":c=void 0;break;default:return}}catch(d){c={value:d,[L]:0}}Promise.resolve(c).catch(e=>({value:e,[L]:0})).then(r=>{const[a,o]=D(r);t.postMessage(Object.assign(Object.assign({},a),{id:n}),o),"RELEASE"===i&&(t.removeEventListener("message",s),_(t),C in e&&"function"==typeof e[C]&&e[C]())}).catch(e=>{const[r,s]=D({value:new TypeError("Unserializable return value"),[L]:0});t.postMessage(Object.assign(Object.assign({},r),{id:n}),s)})}),t.start&&t.start()}function _(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function P(e,t){const r=new Map;return e.addEventListener("message",function(e){const{data:t}=e;if(!t||!t.id)return;const s=r.get(t.id);if(s)try{s(t)}finally{r.delete(t.id)}}),I(e,r,[],t)}function T(e){if(e)throw new Error("Proxy has been released and is not useable")}function A(e){return K(e,new Map,{type:"RELEASE"}).then(()=>{_(e)})}const $=new WeakMap,z="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=($.get(e)||0)-1;$.set(e,t),0===t&&A(e)});function I(e,t,r=[],s=function(){}){let a=!1;const n=new Proxy(s,{get(s,i){if(T(a),i===E)return()=>{!function(e){z&&z.unregister(e)}(n),A(e),t.clear(),a=!0};if("then"===i){if(0===r.length)return{then:()=>n};const s=K(e,t,{type:"GET",path:r.map(e=>e.toString())}).then(H);return s.then.bind(s)}return I(e,t,[...r,i])},set(s,n,i){T(a);const[o,l]=D(i);return K(e,t,{type:"SET",path:[...r,n].map(e=>e.toString()),value:o},l).then(H)},apply(s,n,i){T(a);const o=r[r.length-1];if(o===S)return K(e,t,{type:"ENDPOINT"}).then(H);if("bind"===o)return I(e,t,r.slice(0,-1));const[l,c]=U(i);return K(e,t,{type:"APPLY",path:r.map(e=>e.toString()),argumentList:l},c).then(H)},construct(s,n){T(a);const[i,o]=U(n);return K(e,t,{type:"CONSTRUCT",path:r.map(e=>e.toString()),argumentList:i},o).then(H)}});return function(e,t){const r=($.get(t)||0)+1;$.set(t,r),z&&z.register(e,t,e)}(n,e),n}function U(e){const t=e.map(D);return[t.map(e=>e[0]),(r=t.map(e=>e[1]),Array.prototype.concat.apply([],r))];var r}const W=new WeakMap;function D(e){for(const[t,r]of R)if(r.canHandle(e)){const[s,a]=r.serialize(e);return[{type:"HANDLER",name:t,value:s},a]}return[{type:"RAW",value:e},W.get(e)||[]]}function H(e){switch(e.type){case"HANDLER":return R.get(e.name).deserialize(e.value);case"RAW":return e.value}}function K(e,t,r,s){return new Promise(a=>{const n=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.set(n,a),e.start&&e.start(),e.postMessage(Object.assign({id:n},r),s)})}const B="shacl-history",V=[{key:"all",labelKey:"filter.all"},{key:"violation",labelKey:"severity.violation"},{key:"warning",labelKey:"severity.warning"},{key:"info",labelKey:"severity.info"}],q=[{iri:"http://www.w3.org/ns/adms#",prefix:"adms"},{iri:"http://www.w3.org/2011/content#",prefix:"cnt"},{iri:"http://www.w3.org/ns/dcat#",prefix:"dcat"},{iri:"http://data.europa.eu/r5r/",prefix:"dcatap"},{iri:"http://purl.org/dc/terms/",prefix:"dct"},{iri:"http://data.europa.eu/eli/ontology#",prefix:"eli"},{iri:"http://xmlns.com/foaf/0.1/",prefix:"foaf"},{iri:"http://www.opengis.net/ont/geosparql#",prefix:"geo"},{iri:"http://www.w3.org/ns/locn#",prefix:"locn"},{iri:"http://www.w3.org/ns/odrl/2/",prefix:"odrl"},{iri:"http://www.w3.org/ns/prov#",prefix:"prov"},{iri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",prefix:"rdf"},{iri:"http://www.w3.org/2000/01/rdf-schema#",prefix:"rdfs"},{iri:"http://schema.org/",prefix:"schema"},{iri:"http://www.w3.org/2004/02/skos/core#",prefix:"skos"},{iri:"http://spdx.org/rdf/terms#",prefix:"spdx"},{iri:"http://www.w3.org/2006/time#",prefix:"time"},{iri:"http://www.w3.org/2006/vcard/ns#",prefix:"vcard"},{iri:"http://www.w3.org/2001/XMLSchema#",prefix:"xsd"},{iri:"http://www.w3.org/ns/dqv#",prefix:"dqv"},{iri:"http://www.w3.org/ns/shacl#",prefix:"sh"},{iri:"http://www.w3.org/2002/07/owl#",prefix:"owl"}],F=e=>{if(!e)return"—";const t=q.find(t=>e.startsWith(t.iri));if(t)return`${t.prefix}:${e.slice(t.iri.length)}`;const r=e.lastIndexOf("#");if(r>=0&&r<e.length-1)return e.slice(r+1);const s=e.lastIndexOf("/");return s>=0&&s<e.length-1?e.slice(s+1):e},G=(e,t)=>{if(!e)return r.jsx("span",{className:"text-muted-foreground",children:"—"});const s=t||e;return(e=>!!e&&/^https?:\/\//i.test(e))(e)?r.jsxs("a",{href:e,target:"_blank",rel:"noreferrer",className:"group inline-flex items-center gap-1 text-primary underline-offset-2 transition hover:underline",title:e,children:[r.jsx("span",{className:"line-clamp-2 break-all font-mono",children:s}),r.jsx(w,{className:"h-3 w-3 opacity-70 transition group-hover:opacity-100"})]}):r.jsx("span",{className:"line-clamp-2 break-all font-mono",title:e,children:s})},J={a:({node:e,...t})=>r.jsxs("a",{...t,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 text-primary underline-offset-2 transition hover:underline",children:[t.children,r.jsx(w,{className:"h-3 w-3"})]}),p:({node:e,...t})=>r.jsx("p",{className:"text-sm leading-snug text-foreground",...t}),ul:({node:e,...t})=>r.jsx("ul",{className:"ml-6 list-disc text-sm leading-snug text-foreground",...t})},X=e=>{if(/^\s*\|?.+\|.+\n\s*\|?\s*[-:\s|]+\|/.test(e))return e;if(!/\s*\|\s*/.test(e))return e;let t=e.replace(/\s*\|\s*/g,"\n- ");return t=t.replace(/<?(https?:\/\/[^\s<>)]+)>?/gi,(e,t)=>`[${t}](${t})`),t},Y=e=>{if(e)return e.toLowerCase().split("-")[0]},Z=(e=[])=>e.length?e.map(e=>`${Y(e.lang)||"und"}::${e.text}`).join("||"):"__empty__",Q={Violation:0,Warning:1,Info:2},ee={Violation:{dot:"bg-destructive",pill:"bg-destructive/15 text-destructive"},Warning:{dot:"bg-amber-500",pill:"bg-amber-200/40 text-amber-700 dark:bg-amber-400/20 dark:text-amber-100"},Info:{dot:"bg-sky-500",pill:"bg-sky-200/40 text-sky-700 dark:bg-sky-400/20 dark:text-sky-100"}},te=({report:k})=>{const{t:S,i18n:E}=e(),C=Y(E.language)||"es",[L,O]=t.useState([]),[R,M]=t.useState({violation:0,warning:0,info:0,total:0}),[_,T]=t.useState(()=>{if("undefined"==typeof window)return[];try{return JSON.parse(window.localStorage.getItem(B)||"[]")}catch{return[]}}),[A,$]=t.useState("all"),[z,I]=t.useState({}),U=t.useRef(null);t.useEffect(()=>{const e=new Worker(new URL("/assets/reportWorker-BWiw1jZW.js",import.meta.url),{type:"module"});return U.current=P(e),()=>{e.terminate()}},[]),t.useEffect(()=>{let e=!1;return(async()=>{if(!U.current)return;const{rows:t,summary:r}=await U.current.flattenReport(k);if(e)return;O(t),M(r);const s=[{timestamp:k.timestamp||(new Date).toISOString(),total:r.total},..._].slice(0,10);T(s),"undefined"!=typeof window&&window.localStorage.setItem(B,JSON.stringify(s))})(),()=>{e=!0}},[k]);const W=t.useMemo(()=>"all"===A?L:L.filter(e=>e.severity.toLowerCase().includes(A)),[L,A]),D=t.useMemo(()=>{const e=new Map;return W.forEach((t,r)=>{const s=Z(t.message),a=`${t.severity}-${t.sourceShape}-${t.sourceConstraintComponent}-${s}`;e.has(a)||e.set(a,{id:a,severity:t.severity,messages:t.message||[],sourceShape:t.sourceShape,sourceConstraintComponent:t.sourceConstraintComponent,foafPage:t.foafPage,occurrences:[],total:0});const n=e.get(a);Z(n.messages)!==s&&(n.messages=t.message||[]),n.occurrences.push({id:`${a}-${n.occurrences.length}-${r}`,focusNode:t.focusNode,path:t.path,value:t.value}),n.total+=1}),Array.from(e.values()).sort((e,t)=>Q[e.severity]!==Q[t.severity]?Q[e.severity]-Q[t.severity]:t.total-e.total)},[W]);t.useEffect(()=>{I({})},[A,k]);const H=D.length>10,K=H?{maxHeight:"2100px"}:void 0;return r.jsxs("div",{className:"space-y-6",children:[r.jsxs(o,{children:[r.jsxs(l,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[r.jsxs("div",{children:[r.jsxs(c,{className:"flex items-center gap-2 text-xl",children:[k.conforms?r.jsx(u,{className:"h-5 w-5 text-green-500"}):r.jsx(m,{className:"h-5 w-5 text-destructive"}),k.conforms?S("results.conforms"):S("results.notConforms")]}),r.jsx(d,{children:S("results.summary",{violations:R.violation,warnings:R.warning,infos:R.info})})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs(s,{variant:"outline",size:"sm",className:"gap-2",onClick:async()=>{const e=await n.exportReportAsTurtle(k),t=new Blob([e],{type:"text/turtle"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=`shacl-report-${(new Date).toISOString()}.ttl`,s.click(),URL.revokeObjectURL(r)},children:[r.jsx(f,{className:"h-4 w-4"}),S("results.downloadTTL")]}),r.jsxs(s,{variant:"outline",size:"sm",className:"gap-2",onClick:async()=>{const e=await n.exportReportAsCSV(k),t=new Blob([e],{type:"text/csv"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=`shacl-report-${(new Date).toISOString()}.csv`,s.click(),URL.revokeObjectURL(r)},children:[r.jsx(x,{className:"h-4 w-4"}),S("results.downloadCSV")]})]})]}),r.jsx(p,{children:r.jsx("div",{className:"grid gap-4 md:grid-cols-4",children:[{label:S("severity.violation"),value:R.violation,accent:"text-destructive"},{label:S("severity.warning"),value:R.warning,accent:"text-yellow-500"},{label:S("severity.info"),value:R.info,accent:"text-blue-500"},{label:S("results.totalShapes"),value:R.total,accent:"text-foreground"}].map(e=>r.jsxs("div",{className:"rounded-2xl border border-border p-4",children:[r.jsx("p",{className:"text-xs uppercase text-muted-foreground",children:e.label}),r.jsx("p",{className:a("mt-2 text-3xl font-semibold",e.accent),children:e.value}),e.label===S("results.totalShapes")&&_.length>0&&r.jsx("div",{className:"mt-3 h-16",children:r.jsx(y,{width:"100%",height:"100%",children:r.jsx(b,{data:_.slice(0,7).reverse(),children:r.jsx(j,{type:"monotone",dataKey:"total",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1})})})})]},e.label))})})]}),r.jsxs(o,{children:[r.jsxs(l,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[r.jsxs("div",{children:[r.jsx(c,{children:S("results.details")}),r.jsx(d,{children:S("results.detailsDescription")})]}),r.jsx("div",{className:"flex flex-wrap items-center gap-2",children:V.map(e=>r.jsxs(s,{size:"sm",variant:e.key===A?"default":"ghost",onClick:()=>$(e.key),className:"gap-2",children:["all"!==e.key&&r.jsx(h,{className:"h-3 w-3"}),S(e.labelKey)]},e.key))})]}),r.jsx(p,{children:0===D.length?r.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-border p-10 text-center text-muted-foreground",children:[r.jsx(g,{className:"h-10 w-10 text-green-500"}),r.jsx("p",{children:S("results.noIssues")})]}):r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:a("space-y-4 transition-all duration-300",H&&"overflow-y-auto pr-2 [scrollbar-color:hsl(var(--primary)_/_0.5)_transparent] [scrollbar-width:thin]"),style:K,children:D.map(e=>{const t=e.severity.toLowerCase(),n=ee[e.severity],o=1===e.total?S("results.affectedSingle"):S("results.affectedPlural",{count:e.total}),l=z[e.id]??!1,c=(e.messages.length?((e,t,r="es")=>{if(!e?.length)return;const s=Y(t)||r,a=Y(r)||s,n=e.find(e=>Y(e.lang)===s);if(n)return n.text;const i=e.find(e=>Y(e.lang)===a);return i?i.text:(e.find(e=>!e.lang)||e[0]).text})(e.messages,C):void 0)||S("table.message");return r.jsxs("div",{className:"rounded-2xl border border-border/80 bg-card/60 p-4",children:[r.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx("span",{className:a("h-2 w-2 rounded-full",n.dot),"aria-hidden":"true"}),r.jsx("span",{className:a("rounded-full px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide",n.pill),children:S(`severity.${t}`)}),e.foafPage&&r.jsxs("a",{href:e.foafPage,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border/80 px-2 py-0.5 text-[11px] font-semibold text-primary transition hover:bg-primary/10",children:[r.jsx(w,{className:"h-3 w-3"}),S("results.documentationLink")]})]}),r.jsx("div",{className:"space-y-2",children:r.jsx(N,{className:"space-y-1 text-sm leading-snug text-foreground",components:J,children:X(c)})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[e.sourceShape&&r.jsx("span",{className:"font-mono",title:e.sourceShape,children:F(e.sourceShape)}),e.sourceConstraintComponent&&r.jsx(i,{variant:"outline",className:"rounded-md px-2 py-0 text-[11px] uppercase tracking-tight",title:e.sourceConstraintComponent,children:F(e.sourceConstraintComponent)})]})]}),r.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[r.jsx(i,{variant:"outline",className:"rounded-full px-3 py-1 text-sm font-medium",children:o}),r.jsxs(s,{variant:"ghost",size:"sm",className:"gap-2 text-xs uppercase tracking-wide",onClick:()=>{return t=e.id,void I(e=>({...e,[t]:!e[t]}));var t},children:[r.jsx(v,{className:a("h-4 w-4 transition-transform",l?"rotate-180":"rotate-0")}),S(l?"results.hideOccurrences":"results.showOccurrences")]})]})]}),l&&r.jsxs("div",{className:"mt-4 overflow-hidden rounded-2xl border border-border/70",children:[r.jsxs("div",{className:"grid grid-cols-[minmax(0,0.6fr)_minmax(0,0.5fr)_minmax(0,0.4fr)] gap-4 border-b border-border/60 bg-muted/40 px-4 py-2 text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:[r.jsx("span",{children:S("table.focusNode")}),r.jsx("span",{children:S("table.path")}),r.jsx("span",{children:S("table.value")})]}),e.occurrences.map(e=>r.jsxs("div",{className:"grid grid-cols-[minmax(0,0.6fr)_minmax(0,0.5fr)_minmax(0,0.4fr)] gap-4 px-4 py-3 text-xs text-foreground odd:bg-card/40",children:[r.jsx("div",{className:"min-w-0",children:G(e.focusNode)}),r.jsx("div",{className:"min-w-0",children:G(e.path,F(e.path))}),r.jsx("div",{className:"min-w-0",children:G(e.value)})]},e.id))]})]},e.id)})}),H&&r.jsx("div",{className:"pointer-events-none absolute inset-x-1 bottom-0 h-16 rounded-b-2xl bg-gradient-to-t from-[hsl(var(--background))] via-[hsl(var(--background)/0.7)] to-transparent"})]})})]})]})},re=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));export{te as V,re as a,P as w};

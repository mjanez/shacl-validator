import{i as me,r as y,j as r}from"./vendor-D-Jl8LO8.js";import{B as E,c as C,S as W}from"./index-DHTZvp-P.js";import{B}from"./badge-CpseQUZR.js";import{C as G,a as K,b as q,c as X,d as Y}from"./card-C7mwGPV9.js";import{d as pe,k as xe,l as he,m as ge,n as we,o as ye,E as D,p as be}from"./icons--m-tajHU.js";import{R as ve,L as je,f as ke}from"./charts-CuXAiHm0.js";import{M as Ne}from"./markdown-CoUE547g.js";const te=Symbol("Comlink.proxy"),Se=Symbol("Comlink.endpoint"),Ce=Symbol("Comlink.releaseProxy"),z=Symbol("Comlink.finalizer"),M=Symbol("Comlink.thrown"),re=e=>typeof e=="object"&&e!==null||typeof e=="function",Ee={canHandle:e=>re(e)&&e[te],serialize(e){const{port1:t,port2:n}=new MessageChannel;return ne(e,t),[n,[n]]},deserialize(e){return e.start(),ie(e)}},Re={canHandle:e=>re(e)&&M in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},se=new Map([["proxy",Ee],["throw",Re]]);function Le(e,t){for(const n of e)if(t===n||n==="*"||n instanceof RegExp&&n.test(t))return!0;return!1}function ne(e,t=globalThis,n=["*"]){t.addEventListener("message",function l(a){if(!a||!a.data)return;if(!Le(n,a.origin)){console.warn(`Invalid origin '${a.origin}' for comlink proxy`);return}const{id:o,type:f,path:x}=Object.assign({path:[]},a.data),c=(a.data.argumentList||[]).map(v);let u;try{const d=x.slice(0,-1).reduce((m,b)=>m[b],e),g=x.reduce((m,b)=>m[b],e);switch(f){case"GET":u=g;break;case"SET":d[x.slice(-1)[0]]=v(a.data.value),u=!0;break;case"APPLY":u=g.apply(d,c);break;case"CONSTRUCT":{const m=new g(...c);u=Ie(m)}break;case"ENDPOINT":{const{port1:m,port2:b}=new MessageChannel;ne(e,b),u=Pe(m,[m])}break;case"RELEASE":u=void 0;break;default:return}}catch(d){u={value:d,[M]:0}}Promise.resolve(u).catch(d=>({value:d,[M]:0})).then(d=>{const[g,m]=_(d);t.postMessage(Object.assign(Object.assign({},g),{id:o}),m),f==="RELEASE"&&(t.removeEventListener("message",l),ae(t),z in e&&typeof e[z]=="function"&&e[z]())}).catch(d=>{const[g,m]=_({value:new TypeError("Unserializable return value"),[M]:0});t.postMessage(Object.assign(Object.assign({},g),{id:o}),m)})}),t.start&&t.start()}function Me(e){return e.constructor.name==="MessagePort"}function ae(e){Me(e)&&e.close()}function ie(e,t){const n=new Map;return e.addEventListener("message",function(a){const{data:o}=a;if(!o||!o.id)return;const f=n.get(o.id);if(f)try{f(o)}finally{n.delete(o.id)}}),H(e,n,[],t)}function R(e){if(e)throw new Error("Proxy has been released and is not useable")}function oe(e){return k(e,new Map,{type:"RELEASE"}).then(()=>{ae(e)})}const O=new WeakMap,T="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(O.get(e)||0)-1;O.set(e,t),t===0&&oe(e)});function Oe(e,t){const n=(O.get(t)||0)+1;O.set(t,n),T&&T.register(e,t,e)}function Te(e){T&&T.unregister(e)}function H(e,t,n=[],l=function(){}){let a=!1;const o=new Proxy(l,{get(f,x){if(R(a),x===Ce)return()=>{Te(o),oe(e),t.clear(),a=!0};if(x==="then"){if(n.length===0)return{then:()=>o};const c=k(e,t,{type:"GET",path:n.map(u=>u.toString())}).then(v);return c.then.bind(c)}return H(e,t,[...n,x])},set(f,x,c){R(a);const[u,d]=_(c);return k(e,t,{type:"SET",path:[...n,x].map(g=>g.toString()),value:u},d).then(v)},apply(f,x,c){R(a);const u=n[n.length-1];if(u===Se)return k(e,t,{type:"ENDPOINT"}).then(v);if(u==="bind")return H(e,t,n.slice(0,-1));const[d,g]=J(c);return k(e,t,{type:"APPLY",path:n.map(m=>m.toString()),argumentList:d},g).then(v)},construct(f,x){R(a);const[c,u]=J(x);return k(e,t,{type:"CONSTRUCT",path:n.map(d=>d.toString()),argumentList:c},u).then(v)}});return Oe(o,e),o}function _e(e){return Array.prototype.concat.apply([],e)}function J(e){const t=e.map(_);return[t.map(n=>n[0]),_e(t.map(n=>n[1]))]}const le=new WeakMap;function Pe(e,t){return le.set(e,t),e}function Ie(e){return Object.assign(e,{[te]:!0})}function _(e){for(const[t,n]of se)if(n.canHandle(e)){const[l,a]=n.serialize(e);return[{type:"HANDLER",name:t,value:l},a]}return[{type:"RAW",value:e},le.get(e)||[]]}function v(e){switch(e.type){case"HANDLER":return se.get(e.name).deserialize(e.value);case"RAW":return e.value}}function k(e,t,n,l){return new Promise(a=>{const o=Ae();t.set(o,a),e.start&&e.start(),e.postMessage(Object.assign({id:o},n),l)})}function Ae(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}const Q="shacl-history",ze=[{key:"all",labelKey:"filter.all"},{key:"violation",labelKey:"severity.violation"},{key:"warning",labelKey:"severity.warning"},{key:"info",labelKey:"severity.info"}],Ve=[{iri:"http://www.w3.org/ns/adms#",prefix:"adms"},{iri:"http://www.w3.org/2011/content#",prefix:"cnt"},{iri:"http://www.w3.org/ns/dcat#",prefix:"dcat"},{iri:"http://data.europa.eu/r5r/",prefix:"dcatap"},{iri:"http://purl.org/dc/terms/",prefix:"dct"},{iri:"http://data.europa.eu/eli/ontology#",prefix:"eli"},{iri:"http://xmlns.com/foaf/0.1/",prefix:"foaf"},{iri:"http://www.opengis.net/ont/geosparql#",prefix:"geo"},{iri:"http://www.w3.org/ns/locn#",prefix:"locn"},{iri:"http://www.w3.org/ns/odrl/2/",prefix:"odrl"},{iri:"http://www.w3.org/ns/prov#",prefix:"prov"},{iri:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",prefix:"rdf"},{iri:"http://www.w3.org/2000/01/rdf-schema#",prefix:"rdfs"},{iri:"http://schema.org/",prefix:"schema"},{iri:"http://www.w3.org/2004/02/skos/core#",prefix:"skos"},{iri:"http://spdx.org/rdf/terms#",prefix:"spdx"},{iri:"http://www.w3.org/2006/time#",prefix:"time"},{iri:"http://www.w3.org/2006/vcard/ns#",prefix:"vcard"},{iri:"http://www.w3.org/2001/XMLSchema#",prefix:"xsd"},{iri:"http://www.w3.org/ns/dqv#",prefix:"dqv"},{iri:"http://www.w3.org/ns/shacl#",prefix:"sh"},{iri:"http://www.w3.org/2002/07/owl#",prefix:"owl"}],V=e=>{if(!e)return"—";const t=Ve.find(a=>e.startsWith(a.iri));if(t)return`${t.prefix}:${e.slice(t.iri.length)}`;const n=e.lastIndexOf("#");if(n>=0&&n<e.length-1)return e.slice(n+1);const l=e.lastIndexOf("/");return l>=0&&l<e.length-1?e.slice(l+1):e},$e=e=>!!e&&/^https?:\/\//i.test(e),$=(e,t)=>{if(!e)return r.jsx("span",{className:"text-muted-foreground",children:"—"});const n=t||e;return $e(e)?r.jsxs("a",{href:e,target:"_blank",rel:"noreferrer",className:"group inline-flex items-center gap-1 text-primary underline-offset-2 transition hover:underline",title:e,children:[r.jsx("span",{className:"line-clamp-2 break-all font-mono",children:n}),r.jsx(D,{className:"h-3 w-3 opacity-70 transition group-hover:opacity-100"})]}):r.jsx("span",{className:"line-clamp-2 break-all font-mono",title:e,children:n})},He={a:({node:e,...t})=>r.jsxs("a",{...t,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 text-primary underline-offset-2 transition hover:underline",children:[t.children,r.jsx(D,{className:"h-3 w-3"})]}),p:({node:e,...t})=>r.jsx("p",{className:"text-sm leading-snug text-foreground",...t}),ul:({node:e,...t})=>r.jsx("ul",{className:"ml-6 list-disc text-sm leading-snug text-foreground",...t})},De=e=>{if(/^\s*\|?.+\|.+\n\s*\|?\s*[-:\s|]+\|/.test(e)||!/\s*\|\s*/.test(e))return e;let l=e.replace(/\s*\|\s*/g,`
- `);return l=l.replace(/<?(https?:\/\/[^\s<>)]+)>?/gi,(a,o)=>`[${o}](${o})`),l},N=e=>{if(e)return e.toLowerCase().split("-")[0]},Z=(e=[])=>e.length?e.map(t=>`${N(t.lang)||"und"}::${t.text}`).join("||"):"__empty__",Fe=(e,t,n="es")=>{if(!e?.length)return;const l=N(t)||n,a=N(n)||l,o=e.find(c=>N(c.lang)===l);if(o)return o.text;const f=e.find(c=>N(c.lang)===a);return f?f.text:(e.find(c=>!c.lang)||e[0]).text},L={Violation:0,Warning:1,Info:2},Ue={Violation:{dot:"bg-destructive",pill:"bg-destructive/15 text-destructive"},Warning:{dot:"bg-amber-500",pill:"bg-amber-200/40 text-amber-700 dark:bg-amber-400/20 dark:text-amber-100"},Info:{dot:"bg-sky-500",pill:"bg-sky-200/40 text-sky-700 dark:bg-sky-400/20 dark:text-sky-100"}},ee=10,We=210,Be=({report:e})=>{const{t,i18n:n}=me(),l=N(n.language)||"es",[a,o]=y.useState([]),[f,x]=y.useState({violation:0,warning:0,info:0,total:0}),[c,u]=y.useState(()=>{if(typeof window>"u")return[];try{return JSON.parse(window.localStorage.getItem(Q)||"[]")}catch{return[]}}),[d,g]=y.useState("all"),[m,b]=y.useState({}),P=y.useRef(null);y.useEffect(()=>{const s=new Worker(new URL("/assets/reportWorker-DAn0hnvB.js",import.meta.url),{type:"module"});return P.current=ie(s),()=>{s.terminate()}},[]),y.useEffect(()=>{let s=!1;return(async()=>{if(!P.current)return;const{rows:p,summary:h}=await P.current.flattenReport(e);if(s)return;o(p),x(h);const w=[{timestamp:e.timestamp||new Date().toISOString(),total:h.total},...c].slice(0,10);u(w),typeof window<"u"&&window.localStorage.setItem(Q,JSON.stringify(w))})(),()=>{s=!0}},[e]);const F=y.useMemo(()=>d==="all"?a:a.filter(s=>s.severity.toLowerCase().includes(d)),[a,d]),I=y.useMemo(()=>{const s=new Map;return F.forEach((i,p)=>{const h=Z(i.message),w=`${i.severity}-${i.sourceShape}-${i.sourceConstraintComponent}-${h}`;s.has(w)||s.set(w,{id:w,severity:i.severity,messages:i.message||[],sourceShape:i.sourceShape,sourceConstraintComponent:i.sourceConstraintComponent,foafPage:i.foafPage,occurrences:[],total:0});const j=s.get(w);Z(j.messages)!==h&&(j.messages=i.message||[]),j.occurrences.push({id:`${w}-${j.occurrences.length}-${p}`,focusNode:i.focusNode,path:i.path,value:i.value}),j.total+=1}),Array.from(s.values()).sort((i,p)=>L[i.severity]!==L[p.severity]?L[i.severity]-L[p.severity]:p.total-i.total)},[F]);y.useEffect(()=>{b({})},[d,e]);const A=I.length>ee,ce=A?{maxHeight:`${ee*We}px`}:void 0,de=s=>{b(i=>({...i,[s]:!i[s]}))},fe=async()=>{const s=await W.exportReportAsTurtle(e),i=new Blob([s],{type:"text/turtle"}),p=URL.createObjectURL(i),h=document.createElement("a");h.href=p,h.download=`shacl-report-${new Date().toISOString()}.ttl`,h.click(),URL.revokeObjectURL(p)},ue=async()=>{const s=await W.exportReportAsCSV(e),i=new Blob([s],{type:"text/csv"}),p=URL.createObjectURL(i),h=document.createElement("a");h.href=p,h.download=`shacl-report-${new Date().toISOString()}.csv`,h.click(),URL.revokeObjectURL(p)};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs(G,{children:[r.jsxs(K,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[r.jsxs("div",{children:[r.jsxs(q,{className:"flex items-center gap-2 text-xl",children:[e.conforms?r.jsx(pe,{className:"h-5 w-5 text-green-500"}):r.jsx(xe,{className:"h-5 w-5 text-destructive"}),e.conforms?t("results.conforms"):t("results.notConforms")]}),r.jsx(X,{children:t("results.summary",{violations:f.violation,warnings:f.warning,infos:f.info})})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs(E,{variant:"outline",size:"sm",className:"gap-2",onClick:fe,children:[r.jsx(he,{className:"h-4 w-4"}),t("results.downloadTTL")]}),r.jsxs(E,{variant:"outline",size:"sm",className:"gap-2",onClick:ue,children:[r.jsx(ge,{className:"h-4 w-4"}),t("results.downloadCSV")]})]})]}),r.jsx(Y,{children:r.jsx("div",{className:"grid gap-4 md:grid-cols-4",children:[{label:t("severity.violation"),value:f.violation,accent:"text-destructive"},{label:t("severity.warning"),value:f.warning,accent:"text-yellow-500"},{label:t("severity.info"),value:f.info,accent:"text-blue-500"},{label:t("results.totalShapes"),value:f.total,accent:"text-foreground"}].map(s=>r.jsxs("div",{className:"rounded-2xl border border-border p-4",children:[r.jsx("p",{className:"text-xs uppercase text-muted-foreground",children:s.label}),r.jsx("p",{className:C("mt-2 text-3xl font-semibold",s.accent),children:s.value}),s.label===t("results.totalShapes")&&c.length>0&&r.jsx("div",{className:"mt-3 h-16",children:r.jsx(ve,{width:"100%",height:"100%",children:r.jsx(je,{data:c.slice(0,7).reverse(),children:r.jsx(ke,{type:"monotone",dataKey:"total",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1})})})})]},s.label))})})]}),r.jsxs(G,{children:[r.jsxs(K,{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[r.jsxs("div",{children:[r.jsx(q,{children:t("results.details")}),r.jsx(X,{children:t("results.detailsDescription")})]}),r.jsx("div",{className:"flex flex-wrap items-center gap-2",children:ze.map(s=>r.jsxs(E,{size:"sm",variant:s.key===d?"default":"ghost",onClick:()=>g(s.key),className:"gap-2",children:[s.key!=="all"&&r.jsx(we,{className:"h-3 w-3"}),t(s.labelKey)]},s.key))})]}),r.jsx(Y,{children:I.length===0?r.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-2xl border border-dashed border-border p-10 text-center text-muted-foreground",children:[r.jsx(ye,{className:"h-10 w-10 text-green-500"}),r.jsx("p",{children:t("results.noIssues")})]}):r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:C("space-y-4 transition-all duration-300",A&&"overflow-y-auto pr-2 [scrollbar-color:hsl(var(--primary)_/_0.5)_transparent] [scrollbar-width:thin]"),style:ce,children:I.map(s=>{const i=s.severity.toLowerCase(),p=Ue[s.severity],h=s.total===1?t("results.affectedSingle"):t("results.affectedPlural",{count:s.total}),w=m[s.id]??!1,U=(s.messages.length?Fe(s.messages,l):void 0)||t("table.message");return r.jsxs("div",{className:"rounded-2xl border border-border/80 bg-card/60 p-4",children:[r.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx("span",{className:C("h-2 w-2 rounded-full",p.dot),"aria-hidden":"true"}),r.jsx("span",{className:C("rounded-full px-2 py-0.5 text-[11px] font-semibold uppercase tracking-wide",p.pill),children:t(`severity.${i}`)}),s.foafPage&&r.jsxs("a",{href:s.foafPage,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 rounded-full border border-border/80 px-2 py-0.5 text-[11px] font-semibold text-primary transition hover:bg-primary/10",children:[r.jsx(D,{className:"h-3 w-3"}),t("results.documentationLink")]})]}),r.jsx("div",{className:"space-y-2",children:r.jsx(Ne,{className:"space-y-1 text-sm leading-snug text-foreground",components:He,children:De(U)})}),r.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[s.sourceShape&&r.jsx("span",{className:"font-mono",title:s.sourceShape,children:V(s.sourceShape)}),s.sourceConstraintComponent&&r.jsx(B,{variant:"outline",className:"rounded-md px-2 py-0 text-[11px] uppercase tracking-tight",title:s.sourceConstraintComponent,children:V(s.sourceConstraintComponent)})]})]}),r.jsxs("div",{className:"flex flex-col items-start gap-2 md:items-end",children:[r.jsx(B,{variant:"outline",className:"rounded-full px-3 py-1 text-sm font-medium",children:h}),r.jsxs(E,{variant:"ghost",size:"sm",className:"gap-2 text-xs uppercase tracking-wide",onClick:()=>de(s.id),children:[r.jsx(be,{className:C("h-4 w-4 transition-transform",w?"rotate-180":"rotate-0")}),t(w?"results.hideOccurrences":"results.showOccurrences")]})]})]}),w&&r.jsxs("div",{className:"mt-4 overflow-hidden rounded-2xl border border-border/70",children:[r.jsxs("div",{className:"grid grid-cols-[minmax(0,0.6fr)_minmax(0,0.5fr)_minmax(0,0.4fr)] gap-4 border-b border-border/60 bg-muted/40 px-4 py-2 text-[11px] font-semibold uppercase tracking-wide text-muted-foreground",children:[r.jsx("span",{children:t("table.focusNode")}),r.jsx("span",{children:t("table.path")}),r.jsx("span",{children:t("table.value")})]}),s.occurrences.map(S=>r.jsxs("div",{className:"grid grid-cols-[minmax(0,0.6fr)_minmax(0,0.5fr)_minmax(0,0.4fr)] gap-4 px-4 py-3 text-xs text-foreground odd:bg-card/40",children:[r.jsx("div",{className:"min-w-0",children:$(S.focusNode)}),r.jsx("div",{className:"min-w-0",children:$(S.path,V(S.path))}),r.jsx("div",{className:"min-w-0",children:$(S.value)})]},S.id))]})]},s.id)})}),A&&r.jsx("div",{className:"pointer-events-none absolute inset-x-1 bottom-0 h-16 rounded-b-2xl bg-gradient-to-t from-[hsl(var(--background))] via-[hsl(var(--background)/0.7)] to-transparent"})]})})]})]})},Ze=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{Be as V,Ze as a,ie as w};
